<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Textile Time Travel AR</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.2.1/aframe/build/aframe-ar.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #info {
        position: absolute;
        top: 10px; left: 10px;
        background: rgba(255,255,255,0.8);
        padding: 10px;
        font-family: sans-serif;
        z-index: 1;
      }
      #sidebar {
        position: absolute;
        right: -320px; /* hidden by default */
        top: 0;
        width: 320px;
        height: 100%;
        background: rgba(255,255,255,0.95);
        padding: 20px;
        font-family: sans-serif;
        transition: right 0.3s ease;
        z-index: 2;
        overflow-y: auto;
      }
      #sidebar.open { right: 0; }
      #toggleBtn, #audioBtn {
        position: absolute;
        z-index: 3;
        padding: 8px 12px;
        background: #333; color: #fff;
        border: none; cursor: pointer;
      }
      #toggleBtn { top: 10px; right: 10px; }
      #audioBtn { top: 50px; right: 10px; }
      /* Audio overlay emoji with fade + slide + pop effect */
      #audioOverlay {
        position: absolute;
        bottom: 10px; left: 10px;
        background: rgba(0,0,0,0.6);
        color: #fff;
        padding: 4px 8px;
        font-size: 16px;
        font-family: sans-serif;
        border-radius: 4px;
        z-index: 4;
        opacity: 0;
        transform: translateY(20px) scale(0.9);
        transition: opacity 0.5s ease, transform 0.5s ease;
      }
      #audioOverlay.show {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    </style>
  </head>
  <body>
    <div id="info">
      <strong>AR Textile Cards</strong><br>
      Print or display these markers:<br>
      <a href="markers/spinning.png" target="_blank">Spinning marker</a> |
      <a href="markers/dyeing.png" target="_blank">Dyeing marker</a> |
      <a href="markers/weaving.png" target="_blank">Weaving marker</a>
    </div>

    <button id="toggleBtn" onclick="toggleSidebar()" aria-label="Toggle info sidebar">Show Info</button>
    <button id="audioBtn" onclick="toggleAudio()" aria-label="Toggle audio">Mute Audio</button>

    <div id="sidebar">
      <h3>Task Details</h3>
      <p id="caption">Point your camera at a marker to see details here.</p>
      <p id="audioStatus">ðŸ”‡ Audio OFF</p>
    </div>

    <!-- Audio overlay visible on top of AR scene -->
    <div id="audioOverlay">ðŸ”‡ Audio OFF</div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <!-- Preload videos -->
      <a-assets>
        <video id="spinning" src="assets/videos/spinning.mp4" loop muted></video>
        <video id="dyeing" src="assets/videos/dyeing.mp4" loop muted></video>
        <video id="weaving" src="assets/videos/weaving.mp4" loop muted></video>
      </a-assets>

      <!-- Spinning marker -->
      <a-marker type="pattern" url="markers/spinning.patt" id="marker-spinning">
        <a-video src="#spinning" width="2" height="1" position="0 0 0"></a-video>
      </a-marker>

      <!-- Dyeing marker -->
      <a-marker type="pattern" url="markers/dyeing.patt" id="marker-dyeing">
        <a-video src="#dyeing" width="2" height="1" position="0 0 0"></a-video>
      </a-marker>

      <!-- Weaving marker -->
      <a-marker type="pattern" url="markers/weaving.patt" id="marker-weaving">
        <a-video src="#weaving" width="2" height="1" position="0 0 0"></a-video>
      </a-marker>

      <!-- Camera -->
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('open');
        const btn = document.getElementById('toggleBtn');
        btn.textContent = sidebar.classList.contains('open') ? 'Hide Info' : 'Show Info';
      }

      // Sidebar caption + audio status
      const caption = document.getElementById('caption');
      const audioStatus = document.getElementById('audioStatus');
      const audioOverlay = document.getElementById('audioOverlay');

      // Video elements
      const spinningVideo = document.getElementById('spinning');
      const dyeingVideo = document.getElementById('dyeing');
      const weavingVideo = document.getElementById('weaving');
      const videos = [spinningVideo, dyeingVideo, weavingVideo];

      // Marker events
      document.querySelector('#marker-spinning').addEventListener('markerFound', () => {
        caption.textContent = "Spinning: Took ~2 hours. Fibers twisted into yarn for strength and usability.";
        spinningVideo.play();
      });
      document.querySelector('#marker-spinning').addEventListener('markerLost', () => {
        caption.textContent = "Point your camera at a marker to see details here.";
        spinningVideo.pause();
      });

      document.querySelector('#marker-dyeing').addEventListener('markerFound', () => {
        caption.textContent = "Dyeing: Took ~1 hour. Threads colored to add vibrancy and protect fibers.";
        dyeingVideo.play();
      });
      document.querySelector('#marker-dyeing').addEventListener('markerLost', () => {
        caption.textContent = "Point your camera at a marker to see details here.";
        dyeingVideo.pause();
      });

      document.querySelector('#marker-weaving').addEventListener('markerFound', () => {
        caption.textContent = "Weaving: Took ~3 hours. Threads interlaced to form durable, patterned fabric.";
        weavingVideo.play();
      });
      document.querySelector('#marker-weaving').addEventListener('markerLost', () => {
        caption.textContent = "Point your camera at a marker to see details here.";
        weavingVideo.pause();
      });

      // Audio toggle with fade + slide + pop overlay
      function toggleAudio() {
        const btn = document.getElementById('audioBtn');
        const currentlyMuted = videos[0].muted; // check one video

        videos.forEach(v => v.muted = !currentlyMuted);

        btn.textContent = currentlyMuted ? "Mute Audio" : "Unmute Audio";
        audioStatus.textContent = currentlyMuted ? "ðŸ”Š Audio ON" : "ðŸ”‡ Audio OFF";
        audioOverlay.textContent = currentlyMuted ? "ðŸ”Š Audio ON" : "ðŸ”‡ Audio OFF";

        // Show overlay briefly with fade + slide + pop
        audioOverlay.classList.add('show');
        setTimeout(() => {
          audioOverlay.classList.remove('show');
        }, 1500); // overlay visible for 1.5s
      }

      // Initialize button and status on page load
      window.addEventListener('load', () => {
        const btn = document.getElementById('audioBtn');
        const muted = videos[0].muted;
        btn.textContent = muted ? "Unmute Audio" : "Mute Audio";
        audioStatus.textContent = muted ? "ðŸ”‡ Audio OFF" : "ðŸ”Š Audio ON";
        audioOverlay.textContent = muted ? "ðŸ”‡ Audio OFF" : "ðŸ”Š Audio ON";
      });
    </script>
  </body>
</html>
